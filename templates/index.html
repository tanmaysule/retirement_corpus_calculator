<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retirement Corpus Calculator</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>Retirement Corpus Calculator</h1>
        
        <div class="main-content">
            <div class="input-panel">
                <h2>Investment Parameters</h2>
                <form id="calculatorForm">
                    <div class="form-group">
                        <label for="base_amount">Base Amount (₹)</label>
                        <input type="number" id="base_amount" value="100000" min="0" step="1000">
                    </div>
                    
                    <div class="form-group">
                        <label for="recurring_amount">Recurring Amount (₹)</label>
                        <input type="number" id="recurring_amount" value="10000" min="0" step="1000">
                    </div>
                    
                    <div class="form-group">
                        <label for="step_up_rate">Step Up Rate (%)</label>
                        <input type="range" id="step_up_rate" min="0" max="20" value="7" step="0.1">
                        <span id="step_up_display">7.0</span>%
                    </div>
                    
                    <div class="form-group">
                        <label for="avg_growth_rate">Average Growth Rate (%)</label>
                        <input type="range" id="avg_growth_rate" min="0" max="20" value="11" step="0.1">
                        <span id="growth_rate_display">11.0</span>%
                    </div>
                    
                    <div class="form-group">
                        <label for="investment_year">Investment Start Year</label>
                        <input type="number" id="investment_year" value="2025" min="2000" max="2100">
                    </div>
                    
                    <div class="form-group">
                        <label for="compounding_type">Compounding Type</label>
                        <select id="compounding_type">
                            <option value="monthly">Monthly</option>
                            <option value="yearly" selected>Yearly</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="investment_type">Investment Type</label>
                        <select id="investment_type">
                            <option value="monthly" selected>Monthly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="years_to_calculate">Years to Calculate</label>
                        <input type="range" id="years_to_calculate" min="5" max="50" value="20" step="1">
                        <span id="years_display">20</span> years
                    </div>
                </form>
            </div>
            
            <div class="chart-panel">
                <h2>Investment Growth Over Time</h2>
                <div class="chart-info">
                    <p>Final Amount: <span id="final_amount">₹ 0</span></p>
                </div>
                <canvas id="investmentChart"></canvas>
            </div>
        </div>
    </div>
    
    <script>
        let chart;
        
        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('investmentChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Investment Value (₹)',
                        data: [],
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '₹ ' + value.toLocaleString('en-IN');
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Amount: ₹ ' + context.parsed.y.toLocaleString('en-IN');
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update chart with new data
        function updateChart(years, amounts) {
            chart.data.labels = years;
            chart.data.datasets[0].data = amounts;
            chart.update();
            
            // Update final amount display
            const finalAmount = amounts[amounts.length - 1];
            document.getElementById('final_amount').textContent = '₹ ' + finalAmount.toLocaleString('en-IN');
        }
        
        // Calculate and update chart
        async function calculateAndUpdate() {
            const formData = {
                base_amount: parseFloat(document.getElementById('base_amount').value),
                recurring_amount: parseFloat(document.getElementById('recurring_amount').value),
                step_up_rate: parseFloat(document.getElementById('step_up_rate').value),
                avg_growth_rate: parseFloat(document.getElementById('avg_growth_rate').value),
                investment_year: parseInt(document.getElementById('investment_year').value),
                compounding_type: document.getElementById('compounding_type').value,
                investment_type: document.getElementById('investment_type').value,
                years_to_calculate: parseInt(document.getElementById('years_to_calculate').value)
            };
            
            try {
                const response = await fetch('/calculate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                updateChart(data.years, data.amounts);
            } catch (error) {
                console.error('Error calculating investment:', error);
            }
        }
        
        // Update years display
        function updateYearsDisplay() {
            const years = document.getElementById('years_to_calculate').value;
            document.getElementById('years_display').textContent = years;
        }
        
        // Update step up rate display
        function updateStepUpDisplay() {
            const stepUpRate = document.getElementById('step_up_rate').value;
            document.getElementById('step_up_display').textContent = parseFloat(stepUpRate).toFixed(1);
        }
        
        // Update growth rate display
        function updateGrowthRateDisplay() {
            const growthRate = document.getElementById('avg_growth_rate').value;
            document.getElementById('growth_rate_display').textContent = parseFloat(growthRate).toFixed(1);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            calculateAndUpdate();
            
            // Add event listeners to all form inputs
            const inputs = document.querySelectorAll('#calculatorForm input, #calculatorForm select');
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    if (input.id === 'years_to_calculate') {
                        updateYearsDisplay();
                    } else if (input.id === 'step_up_rate') {
                        updateStepUpDisplay();
                    } else if (input.id === 'avg_growth_rate') {
                        updateGrowthRateDisplay();
                    }
                    calculateAndUpdate();
                });
            });
        });
    </script>
</body>
</html>
